{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { UserRole } from './lib/types'; // Assuming UserRole is exported from here\n\n// 1. Specify protected routes\nconst teacherRoutes = ['/quiz/generate', '/quiz/review'];\nconst studentRoutes = ['/quiz/attempt'];\n\nexport function middleware(request: NextRequest) {\n  // 2. Check for a session cookie\n  const session = request.cookies.get('session');\n\n  // 3. Redirect to login if no session\n  if (!session) {\n    if (teacherRoutes.some(path => request.nextUrl.pathname.startsWith(path)) || studentRoutes.some(path => request.nextUrl.pathname.startsWith(path))) {\n        return NextResponse.redirect(new URL('/login', request.url));\n    }\n    return NextResponse.next();\n  }\n\n  // 4. Decode the session token (replace with your actual decoding logic)\n  let user: { role: UserRole } | null = null;\n  try {\n    // In a real app, you would verify and decode a JWT here\n    // For this example, we'll simulate it based on a simple cookie value\n    if (session.value) {\n        const decoded = JSON.parse(Buffer.from(session.value, 'base64').toString());\n        user = { role: decoded.role };\n    }\n  } catch (error) {\n    console.error('Invalid session token:', error);\n    // Handle invalid token, maybe redirect to login\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n\n  // 5. Redirect based on role\n  if (user) {\n    const { role } = user;\n    const currentPath = request.nextUrl.pathname;\n\n    if (teacherRoutes.some(path => currentPath.startsWith(path)) && role !== 'instructor') {\n      return NextResponse.redirect(new URL('/unauthorized', request.url));\n    }\n\n    if (studentRoutes.some(path => currentPath.startsWith(path)) && role !== 'student') {\n      return NextResponse.redirect(new URL('/unauthorized', request.url));\n    }\n  }\n\n  // 6. Continue to the requested page\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/quiz/generate/:path*', '/quiz/review/:path*', '/quiz/attempt/:path*'],\n};\n"],"names":[],"mappings":";;;;;;AA2BmC;AA1BnC;AAAA;;AAIA,8BAA8B;AAC9B,MAAM,gBAAgB;IAAC;IAAkB;CAAe;AACxD,MAAM,gBAAgB;IAAC;CAAgB;AAEhC,SAAS,WAAW,OAAoB;IAC7C,gCAAgC;IAChC,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEpC,qCAAqC;IACrC,IAAI,CAAC,SAAS;QACZ,IAAI,cAAc,IAAI,CAAC,CAAA,OAAQ,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,UAAU,cAAc,IAAI,CAAC,CAAA,OAAQ,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,QAAQ;YAChJ,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9D;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,wEAAwE;IACxE,IAAI,OAAkC;IACtC,IAAI;QACF,wDAAwD;QACxD,qEAAqE;QACrE,IAAI,QAAQ,KAAK,EAAE;YACf,MAAM,UAAU,KAAK,KAAK,CAAC,+HAAM,CAAC,IAAI,CAAC,QAAQ,KAAK,EAAE,UAAU,QAAQ;YACxE,OAAO;gBAAE,MAAM,QAAQ,IAAI;YAAC;QAChC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,gDAAgD;QAChD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,4BAA4B;IAC5B,IAAI,MAAM;QACR,MAAM,EAAE,IAAI,EAAE,GAAG;QACjB,MAAM,cAAc,QAAQ,OAAO,CAAC,QAAQ;QAE5C,IAAI,cAAc,IAAI,CAAC,CAAA,OAAQ,YAAY,UAAU,CAAC,UAAU,SAAS,cAAc;YACrF,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;QACnE;QAEA,IAAI,cAAc,IAAI,CAAC,CAAA,OAAQ,YAAY,UAAU,CAAC,UAAU,SAAS,WAAW;YAClF,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;QACnE;IACF;IAEA,oCAAoC;IACpC,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAyB;QAAuB;KAAuB;AACnF"}}]
}